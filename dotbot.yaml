- defaults:
    link:
      create: true
      force: true
    shell:
      stderr: true
      stdout: true
- link:
    ~/.zshenv: zsh/.zshenv
    ~/.zprofile: zsh/.zprofile
    ~/.zshrc: zsh/.zshrc
    ~/.zsh_aliases: zsh/.zsh_aliases
    ~/.zsh_functions: zsh/.zsh_functions
    ~/.tmux.conf: tmux/.tmux.conf
    ~/.tmux: tmux/.tmux
    ~/.gitconfig: git/.gitconfig
    ~/.gitignore: git/.gitignore
    ~/.tigrc: git/.tigrc
    ~/.lazygit: git/.lazygit
    ~/.config/nvim: nvim
    ~/.config/lsd: lsd
    ~/.config/kitty: kitty
    ~/.config/pet: pet
    ~/.config/bottom: bottom
    ~/.local/bin/gitleaks-group: bin/gitleaks-group
    ~/.local/bin/lsd-git-help: bin/lsd-git-help
    ~/.local/bin/pet-grouped-list: bin/pet-grouped-list
    ~/.local/bin/show-256-colors: bin/show-256-colors
    ~/.local/bin/tig-dangling: bin/tig-dangling
    ~/.local/bin/tig-gitleaks: bin/tig-gitleaks
- shell:
    - description: Install Homebrew and Brew packages
      command: |-
        if ! command -v brew >/dev/null 2>&1; then
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          eval "$(/opt/homebrew/bin/brew shellenv)"
        fi
        brew update
        brew bundle --file=./Brewfile
        brew bundle list --brews --file=./Brewfile | xargs brew upgrade
        brew bundle list --casks --file=./Brewfile | xargs brew upgrade --cask

    - description: Install Neovim via bob
      command: bob install stable && bob use stable

    - description: Install global npm packages
      command: |-
        grep -vE '^\s*($|#)' npm-packages.txt | \
        xargs -n1 -I {} sh -c '
          printf "%s -> " "{}"
          npm install --no-fund -g "{}" 2>&1 |
          grep -E "(added|changed|removed|up to date|updated|audited)" |
          head -1
        '

    - description: Install multiple Python versions via pyenv
      command: sh ./dotbot-scripts/setup-pyenv.sh 3.9 3.10 3.11 3.12 3.13 3.14

    - description: Install multiple Python versions via uv
      command: |-
        uv python install 3.9 3.10 3.11 3.12 3.13 3.14
        uv python list --only-installed

    - description: Import shell history into atuin
      command: atuin import auto

    - description: Install poetryenv
      command: curl -fsSL https://raw.githubusercontent.com/cdddg/poetryenv/main/install.sh | bash

    - description: Set macOS keyboard shortcuts (Safari sandboxed, use NSGlobalDomain as workaround)
      command: |-
        defaults write NSGlobalDomain NSUserKeyEquivalents -dict-add "翻譯成繁體中文" "@~t"
        defaults write NSGlobalDomain NSUserKeyEquivalents -dict-add "檢視原始頁面" "@~o"

    - description: Set Kitty app icon (requires App Management permission)
      command: kitty +runpy 'from kitty.fast_data_types import cocoa_set_app_icon; import sys; cocoa_set_app_icon(*sys.argv[1:]); print("OK")' "${HOME}/.config/kitty/k0nserv-icon/build/neue_outrun.icns"
